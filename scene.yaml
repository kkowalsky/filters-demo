camera:
    type: perspective
    vanishing_point: [-.25, -.75]

lights:
    light1:
        type: directional
        diffuse: 2

sources:
    osm:
        type: TopoJSONTiles
        url:  http://vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson

styles:
    buildings:
        base: polygons
        shaders:
            uniforms:
                u_height: 0
                u_color_height: 0
            blocks:
                position: position.z *= u_height * .01;
                color: |
                    if (v_world_position.z > u_color_height) color.rgb = vec3(.8);
                    else color.rgb = vec3(.5);

layers:
    earth:
        data: { source: osm }
        draw:
            polygons:
                order: 0
                color: [.5, .5, .5]

    landuse:
        data: { source: osm }
        draw:
            polygons:
                order: 1
                color: [.6, .6, .6]

    water:
        data: { source: osm }
        draw:
            polygons:
                order: 2
                color: [.4, .4, .4]

    roads:
        data: { source: osm }
        properties: { width: 3 }
        draw:
            lines:
                order: 2
                color: [1, 1, 1]
                width: 3

        cycleway:
            filter: { highway: "cycleway" }
            draw:
                lines:
                    order: 2
                    color: [.8, 0, .8]
                    width: function () { return properties.width * 2; }


        bridges:
            filter: { is_bridge: "yes" }
            draw:
                lines:
                    color: [0, .8, .8]
                    width: function () { return properties.width * 3; }

    buildings:
        data: { source: osm }

        # properties: { height: 150 }
        # draw:
            # polygons:
            #     order: 4
            #     color: function () { if (feature.height >= properties.height) { return [1,0,0]; } else { return [1,1,1]; } }
        #     extrude: function () { return ((zoom >= 15 && feature.height > 20) || zoom >= 16) }

        properties:
            min_height: 5
        filter: function () { return feature.height > properties.min_height; }
        draw:
            polygons:
                order: 4
                style: buildings
                color: black # must set a vertex color for shader to be applied
                extrude: true
                interactive: true
